<!DOCTYPE html>
<html>
	<head>
		<title>Loop</title>

		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="Estilo.CSS" />
		<link
			rel="stylesheet"
			href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
			integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
			crossorigin=""
		/>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>

		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
			integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
			crossorigin=""></script>
			
			<style>
				html,
				body {
					height: 100%;
					margin: 0;
				}
				#map {
					width: 480px;
					height: 400px;
				}
			</style>
		</head>

		<body>
			<!-- Simulate a smartphone / tablet -->
			<div class="mobile-container">
				<!-- Top Navigation Menu -->
				<div class="topnav">
	
					<a href="#home" class="active">Nombre Ruta</a>
					
					<div id="myLinks">
						<a id="RutasHabituales" onclick="myMapFunction(this.id);">Rutas Habituales</a>
						<a id="RutasCentral"    onclick="myMapFunction(this.id);">Rutas Turno Central</a>
						<a id="Rutas6"          onclick="myMapFunction(this.id);">6 Rutas</a>
						<a id="Rutas3"          onclick="myMapFunction(this.id);">3 Rutas</a>
						<a id="Rutas1"          onclick="myMapFunction(this.id);">1 Ruta</a>
						<a id="Rutas1Arranque"  onclick="myMapFunction(this.id);">1 Rutas (arranque)</a>
						<a id="Rutas3Arranque"  onclick="myMapFunction(this.id);">3 Rutas (arranque)</a>
					</div>
					<a href="javascript:void(0);" class="icon" onclick="DisplayMenu()"><i class="fa fa-bars"></i></a>
					
					<div id="map"></div>
	

					<table id="jsoncontent"></table>
					<!-- El botón este de abajo no va, pero por ahora no me es importante -->
					<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
				</div>
	
				<!-- End smartphone / tablet look -->
	
<script>

RutasDia = 'Arranque 1'

ruta = ''
//Funciones auxiliares

function DisplayMenu() {
					var x = document.getElementById('myLinks')
					if (x.style.display === 'block') {
                        x.style.display = 'none'} 
                    else {x.style.display = 'block'}
				}
function MyRouteFunction(IDE) {
	Return = IDE
}
function myMapFunction(IDE) {
					DisplayMenu()
					//console.log(IDE)
					// alert(IDE);

					switch (IDE) {
						case 'RutasHabituales':	RutasDia = 'Habituales MTN';	break
						case 'RutasCentral':	RutasDia = "Habituales Central"; break
						case 'Rutas6':			RutasDia = '6';					break
						case 'Rutas3':			RutasDia = '3';					break
						case 'Rutas1':			RutasDia = '1';					break
						case 'Arranque 1':		RutasDia = 'Arranque 1';		break
						case 'Arranque 3':		RutasDia = 'Arranque 3';		break
						default:				RutasDia = 'Habituales MTN';
                    }
}        

 //Tabla
function createHeader(text) {
					const header = document.createElement('th')
					header.textContent = text
					return header
				}

function createCell(text) {
					const cell = document.createElement('td')
					cell.textContent = text
					return cell
				}

//GEOJson
function validateJSON(str) {
					try {JSON.parse(str)} catch (e) {
					return false}
					return true
				}


//Leaflet
function onEachFeature(feature, layer) {layer.bindPopup(feature.Info)}





// Creamos la tabla
const table = document.getElementById('jsoncontent')
const header = table.appendChild(document.createElement('tr'))

header.append(createHeader('Dia'))
header.append(createHeader('Ruta'))
header.append(createHeader('Parada'))
header.append(createHeader('Direccion'))
header.append(createHeader('Provincia'))


//Posicionamos las paradas y generamos la tabla (sale mal)

golfdata= function Descarga(){
fetch('./Rutas.geojson').then((res) => res.json()).then((GeoData) => {return GeoData})
}
	
	fetch('./Rutas.geojson').then((res) => res.json()).then((golfdata) => {
for (const entry of golfdata.features) {
        
			  if (entry.properties.Dia === RutasDia){
				// Append a row.
				const row = document.createElement('tr')
				row.append(createCell(entry.properties.Ruta))
              row.append(createCell(entry.properties.Parada))
              row.append(createCell(entry.properties.Manana))
              row.append(createCell(entry.properties.Tarde))
              row.append(createCell(entry.properties.Noche))
              row.append(createCell(entry.properties.Central))
				table.append(row)
			}
		}





//Creamos el mapa y las capas (?)
Aaa = L.layerGroup();
Bbb = L.layerGroup();
var map = L.map('map', {center: [41.6336504,-0.9083038],zoom: 10,
	maxBounds:L.latLngBounds(L.latLng(41.38, -1.5), L.latLng(42, -0.60))});



L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1}).addTo(map);


		L.geoJSON(golfdata, {
							filter: function (feature, layer) {

										
								if (feature.properties) {
									// If  return false (don't render features)
									if (feature.properties.Dia === RutasDia) {                                             

										return true
									}
								}
							},

							onEachFeature: onEachFeature
						}).addTo(Aaa)

						L.geoJSON(golfdata, {
							filter: function (feature, layer) {

										
								if (feature.properties) {
									// If  return false (don't render features)
									if (feature.properties.Dia === '3') {                                             

										return true
									}
								}
							},

							onEachFeature: onEachFeature
						}).addTo(Bbb)


//Creamos una capa por cada día
	/*for (const entry of golfdata.features) {
		
		if (entry.properties.Dia === RutasDia){
			L.marker([entry.properties.latlong]).bindPopup(entry.properties.Direccion).addTo(Aaa);
		}
			//Se podrían crear los textos del <div id="myLinks"> but not now
	
			 /* if (map.hasLayer(entry.properties.Dia)===false) {
				 map.hasLayer(entry.properties.Dia).addData(entry);
				 window[entry.properties.Dia] = new Array();
			}
	} */




	var baseLayers = {

	};

	var overlays = {
		"Cities": Aaa,
		"Citieses": Bbb
	};

	L.control.layers(baseLayers, overlays).addTo(map);

})
	


</script>



</body>
</html>
