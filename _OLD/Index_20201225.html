<!DOCTYPE html>
<html>
	<head>
		<title>Loop</title>

		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="Estilo.CSS" />
		<link
			rel="stylesheet"
			href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
			integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
			crossorigin=""
		/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
        
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
			integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
			crossorigin=""></script>
			
			<style>
				html,
				body {
					height: 100%;
					margin: 0;
				}
				#map {
					width: 480px;
					height: 400px;
				}
				button {
        width: 100px;
    }
			</style>
		</head>

		<body>
			<!-- Simulate a smartphone / tablet -->
			<div class="mobile-container">
				<!-- Top Navigation Menu -->
				<div class="topnav">
	
					<a href="#home" class="active">Nombre Ruta</a>
					
					<div id="myLinks">
						<a id="Ejemplo" onclick="myMapFunction(this.id);">Ejemplo</a>

					</div>
					<a href="javascript:void(0);" class="icon" onclick="DisplayMenu()"><i class="fa fa-bars"></i></a>
					
					<div id="map"></div>
	
					<div  id="buttons" class="btn-group">
						<button type="button" id="others" class="btn btn-primary">Others</button>
					</div>

					<table id="jsoncontent"></table>
					<!-- El botón este de abajo no va, pero por ahora no me es importante -->
					<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
				</div>
	
				<!-- End smartphone / tablet look -->
	
<script>



//Funciones auxiliares

function DisplayMenu() {
					var x = document.getElementById('myLinks')
					if (x.style.display === 'block') {
                        x.style.display = 'none'} 
                    else {x.style.display = 'block'}
				}

function MyRouteFunction(IDE) {
	Return = IDE
}
function myMapFunction(IDE, j) {
					DisplayMenu()
					//console.log(IDE)
					 alert(IDE);

					switch (IDE) {
						case 'RutasHabituales':	RutasDia = 'Habituales MTN';	break
						case 'RutasCentral':	RutasDia = "Habituales Central"; break
						case 'Rutas6':			RutasDia = '6';					break
						case 'Rutas3':			RutasDia = '3';					break
						case 'Rutas1':			RutasDia = '1';					break
						case 'Arranque 1':		RutasDia = 'Arranque 1';		break
						case 'Arranque 3':		RutasDia = 'Arranque 3';		break
						default:				RutasDia = 'Habituales MTN'; //case 'RutasHabituales': al ser el más habitual lo dejamos por default (?)
                    }

    for (const entry of j) {

			  if (entry.properties.Dia === RutasDia){
				// Append a row.
				const row = document.createElement('tr')
				row.append(createCell(entry.properties.Dia))
				row.append(createCell(entry.properties.Ruta))
				row.append(createCell(entry.properties.Parada))
				row.append(createCell(entry.properties.Direccion))
				row.append(createCell(entry.properties.Provincia))
				table.append(row)
			}
		}

}        

 //Tabla
function createHeader(text) {
					const header = document.createElement('th')
					header.textContent = text
					return header
				}

function createCell(text) {
					const cell = document.createElement('td')
					cell.textContent = text
					return cell
				}

//GEOJson
function validateJSON(str) {
					try {JSON.parse(str)} catch (e) {
					return false}
					return true
				}



// Creamos la tabla
const table = document.getElementById('jsoncontent')
const header = table.appendChild(document.createElement('tr'))

header.append(createHeader('Dia'))
header.append(createHeader('Ruta'))
header.append(createHeader('Parada'))
header.append(createHeader('Direccion'))
header.append(createHeader('Provincia'))



//Creamos el mapa
  //http://zevross.com/blog/2014/10/28/tips-for-creating-leafleft-js-maps/

  var map = L.map('map', {
        center: [41.6336504,-0.9083038],
        zoom: 10,
        maxBounds:L.latLngBounds(L.latLng(41.38, -1.5), L.latLng(42, -0.60))
    }).setView([41.65334, -0.8854287],13)


    var mapboxTiles = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
        attribution: 'ref',
        maxZoom: 18,id: 'mapbox/light-v9',tileSize: 512,zoomOffset: -1,
    });

//create the layer config object first
var baseMaps = {
    "mapboxTiles": mapboxTiles,
};

var overlayMaps = {};


fetch('./Rutas.geojson')
.then((res) => res.json())
.then((data) => {

      // The JavaScript below is new
   $("#others").click(function() {
          if (map.hasLayer(a3_2/3)) {map.removeLayer(a3_2/3)}
          else {map.addLayer(a3_2/3)}
      });

/*var promise = $.getJSON("./Rutas.geojson");
promise.then(function(data)}*/


        // The JavaScript below is new
     $("#others").click(function() {
            if (map.hasLayer(a3_2/3)) {map.removeLayer(a3_2/3)}
            else {map.addLayer(a3_2/3)}
        });



//Dia->Ruta->Parada->Sentido
//Guardamos  en i el primer dato de cada y anadimos una capa que luego rellenaremos
//Dia|Ruta|Parada|Sentido|Layer
//
//Extraemos cuantos días y rutas hay

var i = [];
var j =[];
for (const entry of data.features) {
//Captura la primera ruta de cada Dia
	if (i.includes(entry.properties.Dia) == false){
		var i = [];
		CapaRutas = L.geoJson(data, {
            filter: function(feature, layer) {
                return feature.properties.Dia == entry[0];
            },
            pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                    icon: cafeIcon
                }).on('mouseover', function() {
                    this.bindPopup("a"+feature.properties.Ciudad + feature.properties.Provincia + feature.properties.Info).openPopup();
                });
            }
        });
		i.push(entry.properties.Dia);		
        i.push(entry.properties.Ruta);
		///i.push(CapaRutas);
		j.push(i);
	}
	else{
		if (i.includes(entry.properties.Ruta) == false){
			var i = [];
			i.push(entry.properties.Dia);		
			i.push(entry.properties.Ruta);
			//i.push(CapaRutas);
			j.push(i);
		}
	}
}
//console.log(j[0])
//console.log(j)

const lineBreak = document.createElement('br');

for (const entry of j) {
var layerName= String(entry[1]);

   CapaRutas = L.geoJson(data, {
            filter: function(feature, layer) {
                return feature.properties.Dia == entry[0];
            },
            pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                }).on('mouseover', function() {
                    this.bindPopup("a"+feature.properties.Ciudad + feature.properties.Provincia + feature.properties.Info).openPopup();
                });
            }
        });
    overlayMaps[layerName] = CapaRutas;






//---------------------
//botones de los días
//---------------------

/*<div id="myLinks">
  <a id="RutasHabituales" onclick="myMapFunction(this.id);">Rutas Habituales</a>*/

const NavBar = document.getElementById("myLinks");


var asdf =NavBar.contains(document.getElementById(String(entry[0])));

if ( asdf== false) {
const ElementText = document.createElement('a');
ElementText.id = String(entry[0]);
ElementText.textContent = "Ruta"+" "+String(entry[0]);

ElementText.onclick = myMapFunction(ElementText.id, j);
NavBar.append(ElementText)
}








//---------------------
//botones de ruta
//---------------------
const buttons = document.getElementById("buttons")
        
// <button type="button" id="others" class="btn btn-primary">Others</button>
   
const divElementText = document.createElement('button')
divElementText.type += "button"
divElementText.className += "btn btn-primary"
divElementText.id = layerName;
divElementText.textContent = layerName;
 
divElementText.onclick = function() {//Your code here
                                 }
      
 
buttons.append(divElementText)
/*
No va, paluego
         var qwer =i % 3;
         //console.log(qwer)
         if ((qwer)==0) {
            console.log(qwer)
             buttons.append(lineBreak)
            };
*/
}




L.control.layers(baseMaps, overlayMaps).addTo(map);
});
    




//Funciones auxiliares

function DisplayMenu() {
					var x = document.getElementById('myLinks')
					if (x.style.display === 'block') {
                        x.style.display = 'none'} 
                    else {x.style.display = 'block'}
				}

function MyRouteFunction(IDE) {
	Return = IDE
}
function myMapFunction(IDE) {
					DisplayMenu()
					//console.log(IDE)
					 alert(IDE);

					switch (IDE) {
						case 'RutasHabituales':	RutasDia = 'Habituales MTN';	break
						case 'RutasCentral':	RutasDia = "Habituales Central"; break
						case 'Rutas6':			RutasDia = '6';					break
						case 'Rutas3':			RutasDia = '3';					break
						case 'Rutas1':			RutasDia = '1';					break
						case 'Arranque 1':		RutasDia = 'Arranque 1';		break
						case 'Arranque 3':		RutasDia = 'Arranque 3';		break
						default:				RutasDia = 'Habituales MTN'; //case 'RutasHabituales': al ser el más habitual lo dejamos por default (?)
                    }
console.log(map)

    for (const entry of j) {
              
			  if (entry.properties.Dia === RutasDia){
				// Append a row.
				const row = document.createElement('tr')
				row.append(createCell(entry.properties.Dia))
				row.append(createCell(entry.properties.Ruta))
				row.append(createCell(entry.properties.Parada))
				row.append(createCell(entry.properties.Direccion))
				row.append(createCell(entry.properties.Provincia))
				table.append(row)
			}
		}

}        


</script>



</body>
</html>
